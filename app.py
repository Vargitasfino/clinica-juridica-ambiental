import streamlit as st
import pandas as pd
import plotly.graph_objs as go
import plotly.express as px
from datetime import datetime

st.set_page_config(
    page_title="Cl√≠nica Jur√≠dica-Ambiental",
    page_icon="‚öñÔ∏è",
    layout="wide",
    initial_sidebar_state="expanded"
)

st.markdown("""
    <style>
    .main {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .stApp {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    h1, h2, h3 {
        color: #667eea !important;
    }
    .stAlert {
        background-color: rgba(102, 126, 234, 0.1);
        border-left: 4px solid #667eea;
    }
    </style>
    """, unsafe_allow_html=True)

st.title("‚öñÔ∏è Cl√≠nica Jur√≠dica-Ambiental: Calidad del Aire")
st.markdown("### Normativas y Est√°ndares Internacionales de Calidad del Aire")

st.sidebar.title("üìë Navegaci√≥n")
pagina = st.sidebar.radio(
    "Selecciona una secci√≥n:",
    ["üè† Introducci√≥n",
     "üáµüá™ OEFA Per√∫",
     "üåê OMS",
     "üá∫üá∏ EPA (USA)",
     "üá®üá¶ Canad√°",
     "üìä Comparaci√≥n Normativas",
     "‚è≥ L√≠nea de Tiempo",
     "üìö Recursos"]
)

datos_normativas = {
    'Contaminante': ['PM2.5', 'PM2.5', 'PM10', 'PM10', 'SO‚ÇÇ', 'NO‚ÇÇ', 'NO‚ÇÇ', 'O‚ÇÉ', 'CO'],
    'Per√≠odo': ['24h', 'Anual', '24h', 'Anual', '24h', '1h', 'Anual', '8h', '8h'],
    'OEFA Per√∫': [50, 25, 100, 50, 250, 200, 100, 100, 10000],
    'OMS 2021': [15, 5, 45, 15, 40, 25, 10, 100, 4000],
    'EPA USA': [35, 12, 150, None, None, 100, 53, 70, 9000],
    'Canad√°': [27, 8.8, 50, None, 70, 60, None, 62, 13000],
}

df_normativas = pd.DataFrame(datos_normativas)

timeline_data = [
    {"fecha": "2001-06", "evento": "Per√∫: D.S. N¬∞ 074-2001-PCM establece primeros ECA para aire", "entidad": "OEFA"},
    {"fecha": "2005-10", "evento": "OMS publica Gu√≠as de Calidad del Aire", "entidad": "OMS"},
    {"fecha": "2008-08", "evento": "Per√∫: Se crea el MINAM (Ministerio del Ambiente)", "entidad": "OEFA"},
    {"fecha": "2013-01", "evento": "EPA actualiza est√°ndares de PM2.5 (reducci√≥n a 12 Œºg/m¬≥ anual)", "entidad": "EPA"},
    {"fecha": "2017-06", "evento": "Per√∫: D.S. N¬∞ 003-2017-MINAM establece nuevos ECA m√°s estrictos", "entidad": "OEFA"},
    {"fecha": "2019-12", "evento": "Per√∫: D.S. N¬∞ 010-2019-MINAM modifica ECA para aire", "entidad": "OEFA"},
    {"fecha": "2020-09", "evento": "EPA fortalece est√°ndares de PM2.5", "entidad": "EPA"},
    {"fecha": "2021-09", "evento": "OMS actualiza Directrices Globales con est√°ndares m√°s estrictos", "entidad": "OMS"},
    {"fecha": "2022-03", "evento": "Canad√°: Actualizaci√≥n de Objetivos de Calidad del Aire", "entidad": "Canad√°"},
    {"fecha": "2023-05", "evento": "Per√∫: OEFA intensifica fiscalizaci√≥n en zonas mineras", "entidad": "OEFA"},
    {"fecha": "2024-02", "evento": "EPA propone nuevos est√°ndares m√°s estrictos para PM2.5", "entidad": "EPA"},
    {"fecha": "2024-08", "evento": "Per√∫: Implementaci√≥n de nuevas estaciones de monitoreo en Lima y Arequipa", "entidad": "OEFA"},
]

timeline_df = pd.DataFrame(timeline_data)
timeline_df['fecha'] = pd.to_datetime(timeline_df['fecha'])

if pagina == "üè† Introducci√≥n":
    st.header("üåç Calidad del Aire: Un Derecho Fundamental")
    
    col1, col2 = st.columns([2, 1])
    
    with col1:
        st.info("""
        **¬øPor qu√© es importante?**
        
        La calidad del aire es esencial para la salud p√∫blica y el medio ambiente. Seg√∫n la OMS, 
        la contaminaci√≥n del aire causa aproximadamente **7 millones de muertes prematuras** cada a√±o 
        en todo el mundo. Las normativas ambientales establecen l√≠mites m√°ximos permisibles para 
        proteger la salud de la poblaci√≥n.
        """)
    
    with col2:
        st.metric("Muertes anuales por contaminaci√≥n", "7 millones", "Seg√∫n OMS")
        st.metric("Poblaci√≥n mundial afectada", "99%", "Respira aire contaminado")
    
    st.subheader("üìä Principales Contaminantes del Aire")
    
    tab1, tab2, tab3, tab4, tab5, tab6 = st.tabs(["PM2.5 & PM10", "NO‚ÇÇ", "SO‚ÇÇ", "O‚ÇÉ", "CO", "Pb"])
    
    with tab1:
        col1, col2 = st.columns(2)
        with col1:
            st.markdown("#### üî¥ Material Particulado PM2.5")
            st.markdown("""
            - **Tama√±o:** ‚â§ 2.5 micr√≥metros
            - **Fuentes:** Combusti√≥n de combustibles f√≥siles, industria, veh√≠culos
            - **Efectos en salud:** 
                - Penetra profundamente en los pulmones
                - Enfermedades cardiovasculares
                - C√°ncer de pulm√≥n
                - Muerte prematura
            - **M√°s peligroso:** Por su tama√±o microsc√≥pico
            """)
        with col2:
            st.markdown("#### üü† Material Particulado PM10")
            st.markdown("""
            - **Tama√±o:** ‚â§ 10 micr√≥metros
            - **Fuentes:** Polvo de caminos, construcci√≥n, agricultura
            - **Efectos en salud:**
                - Irritaci√≥n de v√≠as respiratorias
                - Agravamiento de asma
                - Bronquitis cr√≥nica
                - Reducci√≥n de funci√≥n pulmonar
            - **Visible:** A veces como neblina o polvo
            """)
    
    with tab2:
        st.markdown("#### üí® Di√≥xido de Nitr√≥geno (NO‚ÇÇ)")
        col1, col2 = st.columns(2)
        with col1:
            st.markdown("""
            **Fuentes principales:**
            - Tr√°fico vehicular (principal)
            - Plantas de energ√≠a
            - Procesos industriales
            - Calefacci√≥n dom√©stica
            """)
        with col2:
            st.markdown("""
            **Efectos en la salud:**
            - Irritaci√≥n del sistema respiratorio
            - Aumento de susceptibilidad a infecciones
            - Agravamiento del asma
            - Precursor del ozono troposf√©rico
            """)
    
    with tab3:
        st.markdown("#### ‚òÅÔ∏è Di√≥xido de Azufre (SO‚ÇÇ)")
        col1, col2 = st.columns(2)
        with col1:
            st.markdown("""
            **Fuentes principales:**
            - Quema de carb√≥n
            - Refinaci√≥n de petr√≥leo
            - Fundici√≥n de metales
            - Industria qu√≠mica
            """)
        with col2:
            st.markdown("""
            **Efectos:**
            - Causa lluvia √°cida
            - Irritante respiratorio severo
            - Da√±o a vegetaci√≥n
            - Corrosi√≥n de materiales
            """)
    
    with tab4:
        st.markdown("#### üå§Ô∏è Ozono Troposf√©rico (O‚ÇÉ)")
        col1, col2 = st.columns(2)
        with col1:
            st.markdown("""
            **Caracter√≠sticas:**
            - Contaminante secundario
            - Se forma por reacci√≥n fotoqu√≠mica
            - Niveles m√°s altos en d√≠as soleados
            - No emitido directamente
            """)
        with col2:
            st.markdown("""
            **Efectos en la salud:**
            - Da√±a tejido pulmonar
            - Reduce funci√≥n pulmonar
            - Agrava enfermedades respiratorias
            - Afecta cultivos y ecosistemas
            """)
    
    with tab5:
        st.markdown("#### ‚ö†Ô∏è Mon√≥xido de Carbono (CO)")
        col1, col2 = st.columns(2)
        with col1:
            st.markdown("""
            **Caracter√≠sticas:**
            - Gas inodoro e incoloro
            - Combusti√≥n incompleta
            - Muy t√≥xico
            - Dif√≠cil de detectar sin instrumentos
            """)
        with col2:
            st.markdown("""
            **Efectos en la salud:**
            - Reduce ox√≠geno en sangre
            - Da√±o cardiovascular
            - Afecta sistema nervioso
            - Puede ser letal en altas concentraciones
            """)
    
    with tab6:
        st.markdown("#### üè≠ Plomo (Pb)")
        col1, col2 = st.columns(2)
        with col1:
            st.markdown("""
            **Fuentes:**
            - Fundiciones de metales
            - Bater√≠as
            - Pinturas antiguas
            - Combustibles con plomo (prohibidos en muchos pa√≠ses)
            """)
        with col2:
            st.markdown("""
            **Efectos en la salud:**
            - Da√±o neurol√≥gico permanente
            - Retraso en el desarrollo (ni√±os)
            - Problemas de aprendizaje
            - Da√±o renal y cardiovascular
            """)

elif pagina == "üáµüá™ OEFA Per√∫":
    st.header("üáµüá™ OEFA - Organismo de Evaluaci√≥n y Fiscalizaci√≥n Ambiental")
    
    st.info("""
    **¬øQu√© es la OEFA?**
    
    El Organismo de Evaluaci√≥n y Fiscalizaci√≥n Ambiental (OEFA) es el ente rector del Sistema Nacional 
    de Evaluaci√≥n y Fiscalizaci√≥n Ambiental en el Per√∫.
    """)
    
    eca_peru = pd.DataFrame({
        'Contaminante': ['PM2.5', 'PM2.5', 'PM10', 'PM10', 'SO‚ÇÇ', 'NO‚ÇÇ', 'NO‚ÇÇ', 'O‚ÇÉ', 'CO', 'CO'],
        'Per√≠odo': ['24 horas', 'Anual', '24 horas', 'Anual', '24 horas', '1 hora', 'Anual', '8 horas', '8 horas', '1 hora'],
        'Valor ECA (Œºg/m¬≥)': [50, 25, 100, 50, 250, 200, 100, 100, 10000, 30000],
    })
    
    st.dataframe(eca_peru, use_container_width=True)

elif pagina == "üåê OMS":
    st.header("üåê OMS - Organizaci√≥n Mundial de la Salud")
    
    oms_comp = pd.DataFrame({
        'Contaminante': ['PM2.5', 'PM2.5', 'PM10', 'PM10', 'SO‚ÇÇ', 'NO‚ÇÇ', 'NO‚ÇÇ', 'O‚ÇÉ'],
        'Per√≠odo': ['24h', 'Anual', '24h', 'Anual', '24h', '24h', 'Anual', '8h'],
        'OMS 2005 (Œºg/m¬≥)': [25, 10, 50, 20, 20, 25, 40, 100],
        'OMS 2021 (Œºg/m¬≥)': [15, 5, 45, 15, 40, 25, 10, 100],
    })
    
    st.dataframe(oms_comp, use_container_width=True)

elif pagina == "üá∫üá∏ EPA (USA)":
    st.header("üá∫üá∏ EPA - Agencia de Protecci√≥n Ambiental de Estados Unidos")
    
    epa_standards = pd.DataFrame({
        'Contaminante': ['PM2.5', 'PM2.5', 'PM10', 'O‚ÇÉ', 'SO‚ÇÇ', 'NO‚ÇÇ', 'CO'],
        'Per√≠odo': ['24h', 'Anual', '24h', '8h', '1h', '1h', '8h'],
        'Est√°ndar': ['35 Œºg/m¬≥', '12 Œºg/m¬≥', '150 Œºg/m¬≥', '70 ppb', '75 ppb', '100 ppb', '9 ppm'],
    })
    
    st.dataframe(epa_standards, use_container_width=True)

elif pagina == "üá®üá¶ Canad√°":
    st.header("üá®üá¶ Est√°ndares Canadienses de Calidad del Aire")
    
    canada_standards = pd.DataFrame({
        'Contaminante': ['PM2.5', 'PM2.5', 'O‚ÇÉ', 'NO‚ÇÇ', 'SO‚ÇÇ'],
        'Per√≠odo': ['24h', 'Anual', '8h', '1h', '1h'],
        'Est√°ndar 2020 (Œºg/m¬≥)': [27, 8.8, 62, 60, 70],
    })
    
    st.dataframe(canada_standards, use_container_width=True)

elif pagina == "üìä Comparaci√≥n Normativas":
    st.header("üìä Comparaci√≥n de Normativas Internacionales")
    st.dataframe(df_normativas, use_container_width=True)

elif pagina == "‚è≥ L√≠nea de Tiempo":
    st.header("‚è≥ L√≠nea de Tiempo de Cambios Normativos")
    
    fig = px.scatter(timeline_df, 
                     x='fecha', 
                     y='entidad',
                     color='entidad',
                     hover_data=['evento'],
                     title='Eventos Clave en Normativas de Calidad del Aire')
    
    st.plotly_chart(fig, use_container_width=True)

elif pagina == "üìö Recursos":
    st.header("üìö Recursos y Enlaces Oficiales")
    
    st.subheader("üáµüá™ OEFA - Per√∫")
    st.markdown("""
    - [Portal OEFA](https://www.oefa.gob.pe/)
    - Central telef√≥nica: (01) 717-6000
    """)
    
    st.subheader("üåê OMS")
    st.markdown("""
    - [Directrices OMS 2021](https://www.who.int/)
    """)

st.markdown("---")
st.markdown("""
<div style='text-align: center; padding: 20px;'>
    <h3>‚öñÔ∏è Cl√≠nica Jur√≠dica-Ambiental</h3>
    <p>¬© 2024 - Informaci√≥n basada en fuentes oficiales de OEFA, OMS, EPA y Canad√°</p>
</div>
""", unsafe_allow_html=True)
